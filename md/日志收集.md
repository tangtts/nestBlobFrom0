# ğŸ« æ—¥å¿—æ”¶é›†

- æ ¼å¼åŒ–
  - æ—¶é—´æˆ³
  - æ ¼å¼ç¾åŒ–
- æ—¥å¿—åˆ†å‰²
  - æŒ‰æ–‡ä»¶å¤§å°åˆ†å‰²
  - æŒ‰å†™å…¥æ—¶é—´åˆ†å‰²
- æ—¥å¿—åˆ†çº§

  - `DEBUG`ï¼šè°ƒè¯•ï¼Œç­‰çº§æœ€ä½ï¼Œä¸€èˆ¬ç”Ÿäº§ç¯å¢ƒä¼šå°†è¯¥ç­‰çº§çš„æ—¥å¿—å…³é—­
  - `INFO`ï¼šä¿¡æ¯ï¼Œæ™®é€šç­‰çº§ï¼Œæœ€å¸¸ç”¨çš„ç³»ç»Ÿæ—¥å¿—æ”¶é›†ç­‰çº§ï¼Œä¸€èˆ¬ä¼šå°†ç³»ç»Ÿè¿è¡Œä¸­çš„ä¸€äº›ç›¸å…³ä¿¡æ¯ï¼ˆéå¼€å‘ç±»æ•æ„Ÿä¿¡æ¯ï¼‰è®¾ä¸ºè¯¥ç­‰çº§
  - `WARN`ï¼š*FBI WARNNING*å¤§å®¶éƒ½çŸ¥é“ï¼Œå°±æ˜¯è­¦å‘Šï¼Œä½†åˆä¸åˆ°é”™è¯¯
  - `ERROR`ï¼šæŠ¥é”™ï¼Œä¸€èˆ¬ç¨‹åºæŠ¥é”™ä½¿ç”¨è¯¥ç­‰çº§
  - `FATAL`ï¼šä¸¥é‡ï¼Œæ¯”ç¨‹åºæŠ¥é”™è¿˜ä¸¥é‡çš„ç­‰çº§ï¼Œå¦‚æœæ²¡åšé”™è¯¯ç­‰çº§åˆ’åˆ†çš„è¯ï¼Œä¸€èˆ¬`FATAL`éƒ½ä¸æ€ä¹ˆç”¨åˆ°ï¼Œéƒ½ç”¨`ERROR`æ›¿ä»£äº†

  ```sh
   pnpm i winston
  ```

  1. å®šä¹‰ `shared/logger/logger.service.ts` æ–‡ä»¶

```js
import { ConfigService } from "@nestjs/config";
import { createLogger, format, Logger, transports } from "winston";

export class AppLogger {
  private context?: string;
  private logger: Logger;

  public setContext(context: string): void {
    this.context = context;
  }

  constructor( private readonly configService:ConfigService) {

    // console.log(this.configService.get("database"))

    this.logger = createLogger({
      level: "info",
      format: format.combine(format.timestamp(), format.prettyPrint()),

      transports: [
        new transports.Console(),
        new transports.File({ filename: "logs/error.log", level: "error" }),
        new transports.File({ filename: "logs/combined.log" }),
      ],
    });
  }

  error(ctx: any, message: string, meta?: Record<string, any>): Logger {
    return this.logger.error({
      message,
      contextName: this.context,
      ctx,
      ...meta,
    });
  }

  warn(ctx: any, message: string, meta?: Record<string, any>): Logger {
    return this.logger.warn({
      message,
      contextName: this.context,
      ctx,
      ...meta,
    });
  }

  debug(ctx: any, message: string, meta?: Record<string, any>): Logger {
    return this.logger.debug({
      message,
      contextName: this.context,
      ctx,
      ...meta,
    });
  }

  info(ctx: any, message: string, meta?: Record<string, any>): Logger {
    return this.logger.info({
      message,
      contextName: this.context,
      ctx,
      ...meta,
    });
  }
}
```

2. å®šä¹‰æ¨¡å— `logger.module.ts`

```js
@Module({
  providers: [AppLogger],
  exports: [AppLogger],
})
export class AppLoggerModule {}
```

3. `shared` æ¨¡å—å¼•ç”¨

```js
   @Module({
  imports: [
    ConfigModule.forRoot(configModuleOptions),
    AppLoggerModule
  ],
  providers: [SystemService,...DatabaseProviders],
  exports:[SystemService,ConfigModule,...DatabaseProviders,AppLoggerModule],
})
```

4.  ä½¿ç”¨

```js
export class UserService {

constructor(
  // è¿½åŠ æ¨¡å—æ³¨å…¥
  private readonly systemService: SystemService,
  @Inject('USER_REPOSITORY')
  private readonly userRepository: MongoRepository<User>,
  private readonly logger: AppLogger
  ) {
    // è®¾ç½®åå­—
    this.logger.setContext(UserService.name)
}

  this.logger.info(null,'user error',{
    a:13213
  })
```
